_switch = ((_this select 3) select 0);if (isNil "hasDrugDealerJob") then{	hasDrugDealerJob = false;};if (isNil "isDealer") then{	isDealer = false;};if (isNil "xZe_drugGetSettings") then{	xZe_drugGetSettings =	{		private ["_type", "_return"];		_type = _this;		{			if (_x select 0 == _type) exitWith			{				_x			};		} forEach drugDealerJobSettings;	};};if (isNil "xZe_drugClientCleanUp") then{	xZe_drugClientCleanUp =	{		_markerName = format["drugDealClientMarker%1", player];		deleteMarkerLocal _markerName;		hasDrugDealerJob = false;	};};if (_switch == "server") then{	serverDrugAddicts = [];	for [{_i=0},{_i < numDrugAddicts},{_i=_i+1}] do	{		_randomPoint = drugDealerJobLocations select (ceil random ((count drugDealerJobLocations)-1));		_spawnPoint = getMarkerPos _randomPoint;		_spawnPoint = [(_spawnPoint select 0)+random 125,(_spawnPoint select 1)+random 125,0];		_randomClient = drugAddicts select (ceil random ((count drugAddicts)-1));		call compile format["		_randomClient createUnit[_spawnPoint, group drugLogic, ""DDClient%1 = this; this setVehicleVarName """"DDClient%1""""; this disableAI """"TARGET"""";""];", _i];		processInitCommands;				call compile format["		serverDrugAddicts = serverDrugAddicts + [ [DDClient%1, %1] ];		DDClient%1 Action[""sitdown"", DDClient%1];		DDClient%1 setDir (random 360);		", _i];				drugLogic setBehaviour "CARELESS";	};	publicVariable "serverDrugAddicts";		[] spawn	{		while {true} do		{			{				_obj = _x select 0;				_num = _x select 1;				if (!alive _obj) then				{					_obj setpos[0,0,0];					deleteVehicle _obj;					_randomPoint = drugDealerJobLocations select (ceil random ((count drugDealerJobLocations)-1));					_spawnPoint = getMarkerPos _randomPoint;					_spawnPoint = [(_spawnPoint select 0)+random 125,(_spawnPoint select 1)+random 125,0];					_randomClient = drugAddicts select (ceil random ((count drugAddicts)-1));										call compile format["					_randomClient createUnit[_spawnPoint, group drugLogic, ""DDClient%1 = this; this setVehicleVarName """"DDClient%1""""; this disableAI """"TARGET"""";""];", _num];					processInitCommands;							call compile format["					serverDrugAddicts set[_num,[DDClient%1, %1]];					DDClient%1 Action[""sitdown"", DDClient%1];					DDClient%1 setDir (random 360);					", _num];										publicVariable "serverDrugAddicts";					drugLogic setBehaviour "CARELESS";				};			} forEach serverDrugAddicts;							sleep 25;		};	};	};if (isNil "DD_createClient") then{	DD_createClient =	{		if (hasDrugDealerJob) exitWith		{			player groupchat "You already are drug dealing";		};			hasDrugDealerJob = true;			_type = (_this select 0);		_settings = _type call xZe_drugGetSettings;		_randomClient = serverDrugAddicts select (ceil random ((count serverDrugAddicts)-1));		_maxAmount = _this select 1;		_minAmount = _this select 2;		_amount =  _this select 3;		_itemName = _type call INV_getitemName;				LdrugDealerClient = _randomClient select 0;			if (_amount < _minAmount) then		{			_amount = _minAmount;		};				_markerName = format["drugDealClientMarker%1", player];		_marker = createMarkerLocal [_markerName, getPos LdrugDealerClient];		_marker setMarkerShapeLocal "ICON";		_markerName setMarkerTypeLocal "JOIN";		_markerName setMarkerTextLocal format["Drug Client: %1x %2", _amount, _itemName];		_markerName setMarkerSizeLocal [0.6,0.6];		_markerName setMarkerColorLocal "ColorRed";				[_type,_amount] spawn		{			_markerName = format["drugDealClientMarker%1", player];			while {hasDrugDealerJob} do			{				_markerName setMarkerPosLocal getpos LdrugDealerClient;							if (player distance getpos LdrugDealerClient <= 5) then				{					[(_this select 0), (_this select 1)] call DD_sell;				};							if (!alive LdrugDealerClient) then				{					if (hasDrugDealerJob) then					{						player groupchat "Your client has been killed!";						[] call xZe_drugClientCleanup;					};									if (!hasDrugDealerJob) exitWith {};				};					sleep 10;			};		};	};};if (isNil "DD_sell") then{	DD_sell =	{		_type = (_this select 0);		_amount = (_this select 1);		_itemAmount = _type call INV_getitemAmount;		_itemName = _type call INV_getitemName;			if (_itemAmount < _amount ) exitWith 		{			player groupchat "You dont have enough to sell to the client";		};			_sellPrice = _type call INV_getitemSellCost;		_sellPrice = _sellPrice * _amount;			["money", _sellPrice] call INV_addInventoryItem;		[_type, -(_amount)] call INV_addInventoryItem;			player groupchat format["You sell %1 %2 to the client for $%3", _amount, _itemName, _sellPrice];		[] call xZe_drugClientCleanup;	};};if (_switch == "startDealing") then{	private ["_type"];	_type = ((_this select 3) select 1);		if (isDealer) exitWith	{		player groupchat "You are already a drug dealer";	};		if (hasDrugDealerJob) exitWith	{		player groupchat "You cannot drug deal yet";	};		isDealer = true;		player groupchat "You start drug dealing, a client will SMS you when he wants to buy some drugs";		[_type] spawn	{		private ["_type"];		_type = _this select 0;		while {isDealer} do		{			if (!hasDrugDealerJob) then			{				_chance = random 100;				_phoneAmount = "handy" call INV_getitemAmount;				_hasPhone = false;								if (_phoneAmount >= 1) then				{					_hasPhone = true;				};				_numCops = 1;				{					if (alive _x) then { _numCops = _numCops + 1; };				} forEach coparray;								_settings = _type call xZe_drugGetSettings;				_maxAmount = (((_settings) select 1) select 0);				_minAmount = (((_settings) select 1) select 1);				_amount =  (floor(random ((_maxAmount - _minAmount)+ _minAmount)));				_itemName = _type call INV_getitemName;								if (_amount < _minAmount) then 				{					_amount = _minAmount;				};								_clientChance = (drugDealerClientChance * _numCops);								if (_chance <= _clientChance) then				{					if (_hasPhone) then					{						hint format [localize "STRS_inv_item_handy_nachricht", format["I want to buy %1 %2, check your map for the location", _amount, _itemName], "Unknown"]; 						player say ["sms_incoming",1];						[_type, _maxAmount, _minAmount, _amount] spawn DD_createClient;					};				};							};					sleep 60;		};	};	};if (_switch == "cancel") then{	if (hasDrugDealerJob) then	{		[] call xZe_drugClientCleanup;		player groupchat format["You decide not to sell to the client, you must wait %1 seconds before you can get another job", drugDealerJobWaitTime];	};		isDealer = false;		[] spawn	{		private ["_i"];		_i = 0;		hasDrugDealerJob = true;		while {true} do		{			if (_i == drugDealerJobWaitTime) exitWith			{				player groupchat "You can start dealing again now";				hasDrugDealerJob = false;			};			_i = _i + 1;			sleep 1;		};	};};